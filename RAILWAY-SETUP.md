# Railway Setup Instructions

## Важно: Используйте только ОДИН сервис (Server)

Railway автоматически определил два сервиса (@worms-arena/client и @worms-arena/server), но вам нужен **только Server сервис**, так как он отдает статику клиента.

## Шаги настройки:

### 1. Удалите Client сервис
- В Railway Dashboard найдите сервис `@worms-arena/client`
- Удалите его (он не нужен)

### 2. Настройте Server сервис

**Build Command:**
```
npm run build
```
Это соберет shared, server и client пакеты.

**Start Command:**
```
cd packages/server && npm start
```

**Root Directory:**
Оставьте пустым (корень репозитория)

### 3. Переменные окружения (опционально)

Если у вас есть доступ к Volumes (платная функция):
- Добавьте Volume с Mount Path: `/data`
- Установите переменную окружения: `DATA_PATH=/data/worms-arena-store.json`

Если Volumes недоступны:
- Данные будут храниться в `packages/server/data/store.json`
- Данные сохраняются во время работы сервиса, но теряются при полном перезапуске
- Это нормально для начала - можно добавить Volume позже

### 4. Переменные окружения (обязательные)

Railway автоматически установит:
- `PORT` - порт для сервера
- `RAILWAY_ENVIRONMENT` - определит, что мы на Railway

Никаких дополнительных переменных не требуется.

### 5. Deploy

Нажмите "Deploy" и Railway соберет и запустит проект.

## Автоматический деплой

Railway **автоматически деплоит** изменения из GitHub:
- ✅ При каждом `git push` в основную ветку (обычно `main`)
- ✅ Railway отслеживает подключенный репозиторий
- ✅ Автоматически запускает сборку и деплой
- ✅ Можно настроить какие ветки деплоить в настройках сервиса

**Как это работает:**
1. Вы делаете изменения в коде
2. Делаете `git push origin main`
3. Railway автоматически видит изменения
4. Запускает новый деплой
5. Обновляет приложение без вашего участия

**Отключить автодеплой:**
- В настройках сервиса → Settings → Source
- Можно отключить "Auto Deploy" и деплоить вручную

## Если изменения не появляются на сайте

1. **Очистить кэш сборки Railway:** в Dashboard → сервис → **Deployments** → три точки у последнего деплоя → **Redeploy** с опцией **Clear build cache** (если есть), или в **Settings** отключите и снова включите кэш.
2. **Жёсткое обновление в браузере:** на сайте wormsarena.fun нажмите **Ctrl+F5** (Windows) или **Cmd+Shift+R** (Mac), чтобы не использовать кэш.
3. **Проверить коммит деплоя:** в Railway в деплое должен быть последний коммит из `main` (например `27f36f2` или новее).

Сервер теперь отдаёт `index.html` с заголовком **Cache-Control: no-store**, поэтому после следующего деплоя браузер будет загружать свежую версию.

## Проверка после деплоя:

1. **Health check:** `https://your-app.railway.app/api/health`
2. **Главная страница:** `https://your-app.railway.app`
3. **WebSocket:** `wss://your-app.railway.app/ws`

## Почему только Server?

Сервер уже настроен на отдачу статики клиента в production:
- Проверяет наличие `packages/client/dist`
- Если есть - отдает статику через Express
- Если нет - проксирует на Vite dev server (в development)

Поэтому отдельный Client сервис не нужен.
